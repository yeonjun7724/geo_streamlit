import streamlit as st
import folium
from streamlit_folium import st_folium
import pandas as pd
import plotly.express as px
from datetime import datetime

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Page config
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.set_page_config(
    page_title="í•˜ë‚¨ì‹œ MAT ê¸°ë°˜ ì•„íŒŒíŠ¸ ë„¤ë¹„ê²Œì´ì…˜",
    page_icon="ğŸ¢",
    layout="wide",
    initial_sidebar_state="expanded",
)

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Data
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
HANAM_APARTMENTS = {
    "ë¯¸ì‚¬ê°•ë³€ í•œê°•ì„¼íŠ¸ëŸ´íŒŒí¬": {
        "center": [37.5621, 127.1734],
        "entrance": [37.5619, 127.1732],
        "buildings": [
            {"name": "101ë™", "lat": 37.5623, "lon": 127.1736},
            {"name": "102ë™", "lat": 37.5625, "lon": 127.1738},
            {"name": "103ë™", "lat": 37.5627, "lon": 127.1740},
        ],
        "facilities": [
            {"name": "ì†Œí™”ì „ #1", "lat": 37.5622, "lon": 127.1735, "type": "hydrant"},
            {"name": "ê´€ë¦¬ì‚¬ë¬´ì†Œ", "lat": 37.5620, "lon": 127.1733, "type": "office"},
        ],
    },
    "ë¯¸ì‚¬ê°•ë³€ ì‹ ë¦¬ë§ˆì„": {
        "center": [37.5645, 127.1689],
        "entrance": [37.5643, 127.1687],
        "buildings": [
            {"name": "201ë™", "lat": 37.5647, "lon": 127.1691},
            {"name": "202ë™", "lat": 37.5649, "lon": 127.1693},
        ],
        "facilities": [
            {"name": "ì†Œí™”ì „ #2", "lat": 37.5646, "lon": 127.1690, "type": "hydrant"},
        ],
    },
    "ê³ ë• ë˜ë¯¸ì•ˆ": {
        "center": [37.5498, 127.1542],
        "entrance": [37.5496, 127.1540],
        "buildings": [
            {"name": "301ë™", "lat": 37.5500, "lon": 127.1544},
            {"name": "302ë™", "lat": 37.5502, "lon": 127.1546},
        ],
        "facilities": [
            {"name": "ì†Œí™”ì „ #3", "lat": 37.5499, "lon": 127.1543, "type": "hydrant"},
        ],
    },
    "ê³ ë• ê·¸ë¼ì‹œì›€": {
        "center": [37.5521, 127.1578],
        "entrance": [37.5519, 127.1576],
        "buildings": [
            {"name": "401ë™", "lat": 37.5523, "lon": 127.1580},
        ],
        "facilities": [
            {"name": "ê´€ë¦¬ì‚¬ë¬´ì†Œ", "lat": 37.5520, "lon": 127.1577, "type": "office"},
        ],
    },
}

SCENARIO_STYLES = {
    "ì¼ë°˜ ìƒí™©": {"route_color": "blue", "icon_color": "blue"},
    "ê¸´ê¸‰ ìƒí™© (ì†Œë°©)": {"route_color": "red", "icon_color": "red"},
    "ê¸´ê¸‰ ìƒí™© (êµ¬ê¸‰)": {"route_color": "green", "icon_color": "green"},
}

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Sidebar
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with st.sidebar:
    st.header("ğŸ“ ì—°êµ¬ì§€ì—­ ì„¤ì •")

    apartment_complex = st.selectbox(
        "ì•„íŒŒíŠ¸ ë‹¨ì§€ ì„ íƒ",
        list(HANAM_APARTMENTS.keys()),
        index=0,
    )

    destination_type = st.selectbox(
        "ëª©ì ì§€ ìœ í˜•",
        ["ë™ ì¶œì…êµ¬", "ì†Œí™”ì „", "ê´€ë¦¬ì‚¬ë¬´ì†Œ", "ì§€í•˜ì£¼ì°¨ì¥", "ë†€ì´í„°"],
        index=0,
    )

    scenario = st.radio(
        "ë¹„êµ ì‹œë‚˜ë¦¬ì˜¤",
        ["ì¼ë°˜ ìƒí™©", "ê¸´ê¸‰ ìƒí™© (ì†Œë°©)", "ê¸´ê¸‰ ìƒí™© (êµ¬ê¸‰)"],
        index=0,
    )

    st.divider()

    st.subheader("ğŸ“Š í˜„ì¬ ì„±ê³¼")
    c1, c2 = st.columns(2)
    with c1:
        st.metric("ì„œë¹„ìŠ¤ ì§€ì—­", "í•˜ë‚¨ì‹œ", "1ê°œ ì‹œ")
        st.metric("ë“±ë¡ ë‹¨ì§€", "342ê°œ", "+12ê°œ")
    with c2:
        st.metric("í‰ê·  ì‹œê°„ë‹¨ì¶•", "23%", "+2.1%")
        st.metric("ì •í™•ë„", "97.8%", "+0.5%")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Helpers
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

def make_as_is_map(apt: dict, route_color: str) -> folium.Map:
    m = folium.Map(location=apt["center"], zoom_start=17, tiles="OpenStreetMap")

    folium.Marker(
        location=apt["entrance"],
        popup="ì•„íŒŒíŠ¸ ì •ë¬¸ (ê¸°ì¡´ ë„¤ë¹„ ì¢…ë£Œ ì§€ì )",
        icon=folium.Icon(color="red", icon="stop"),
    ).add_to(m)

    folium.PolyLine(
        locations=[
            [37.5600, 127.1700],  # ìƒ˜í”Œ ì¶œë°œì§€
            apt["entrance"],
        ],
        color=route_color,
        weight=3,
        opacity=0.7,
        popup="ê¸°ì¡´ ë„¤ë¹„ ê²½ë¡œ",
    ).add_to(m)

    return m


def make_to_be_map(apt: dict, route_color: str, icon_color: str) -> folium.Map:
    m = folium.Map(location=apt["center"], zoom_start=17, tiles="OpenStreetMap")

    # ê±´ë¬¼ ì¶œì…êµ¬
    for b in apt["buildings"]:
        folium.Marker(
            location=[b["lat"], b["lon"]],
            popup=f"{b['name']} ì¶œì…êµ¬",
            icon=folium.Icon(color=icon_color, icon="home"),
        ).add_to(m)

    # ì‹œì„¤ë¬¼
    for f in apt["facilities"]:
        color = "red" if f["type"] == "hydrant" else "green"
        icon = "tint" if f["type"] == "hydrant" else "info-sign"
        folium.Marker(
            location=[f["lat"], f["lon"]],
            popup=f["name"],
            icon=folium.Icon(color=color, icon=icon),
        ).add_to(m)

    # MAT ê¸°ë°˜ ê²½ë¡œ (ìƒ˜í”Œ ê²½ë¡œ: ì •ë¬¸ â†’ ì²« ë²ˆì§¸ ë™)
    if apt["buildings"]:
        target = apt["buildings"][0]
        folium.PolyLine(
            locations=[
                [37.5600, 127.1700],  # ìƒ˜í”Œ ì¶œë°œì§€
                apt["entrance"],
                [target["lat"], target["lon"]],
            ],
            color=route_color,
            weight=4,
            opacity=0.85,
            popup="MAT ê¸°ë°˜ ì •ë°€ ê²½ë¡œ",
        ).add_to(m)

    return m


# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Main Title
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.title("ğŸ¢ í•˜ë‚¨ì‹œ MAT ê¸°ë°˜ ì•„íŒŒíŠ¸ ë„¤ë¹„ê²Œì´ì…˜")
st.caption("ë²¡í„° ì¤‘ì¶• ë³€í™˜(MAT) ì•Œê³ ë¦¬ì¦˜ì„ í™œìš©í•œ ì•„íŒŒíŠ¸ ë‹¨ì§€ ë‚´ ì •ë°€ ë„¤ë¹„ê²Œì´ì…˜")

# Tabs
as_is_tab, effect_tab, sim_tab = st.tabs(["ğŸ”„ AS IS vs TO BE", "ğŸ“Š íš¨ê³¼ ë¶„ì„", "ğŸ—ºï¸ ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜"])

# Selected apartment
selected = HANAM_APARTMENTS[apartment_complex]
style = SCENARIO_STYLES[scenario]

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Tab 1: AS-IS vs TO-BE
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with as_is_tab:
    st.subheader("ğŸ”„ ê¸°ì¡´ ë„¤ë¹„ê²Œì´ì…˜ vs MAT ê¸°ë°˜ ë„¤ë¹„ê²Œì´ì…˜")

    c1, c2 = st.columns(2)

    with c1:
        st.markdown("#### âŒ AS IS - ê¸°ì¡´ ë„¤ë¹„ê²Œì´ì…˜")
        m1 = make_as_is_map(selected, style["route_color"]) 
        st_folium(m1, use_container_width=True, height=320)
        st.error("ì •ë¬¸ê¹Œì§€ë§Œ ì•ˆë‚´ ê°€ëŠ¥")
        st.markdown(
            """
            â€¢ ëª©ì ì§€: ì•„íŒŒíŠ¸ ì •ë¬¸  
            â€¢ ë‹¨ì§€ ë‚´ ê¸¸ì°¾ê¸°: ë¶ˆê°€ëŠ¥  
            â€¢ ì¶”ê°€ ë„ë³´ì‹œê°„: 3â€“5ë¶„  
            â€¢ ê¸´ê¸‰ìƒí™© ëŒ€ì‘: ì œí•œì 
            """
        )

    with c2:
        st.markdown("#### âœ… TO BE - MAT ê¸°ë°˜ ë„¤ë¹„ê²Œì´ì…˜")
        m2 = make_to_be_map(selected, style["route_color"], style["icon_color"]) 
        st_folium(m2, use_container_width=True, height=320)
        st.success("ë™ ì¶œì…êµ¬ê¹Œì§€ ì •í™•í•œ ì•ˆë‚´")
        # ëª©ì ì§€ ìœ í˜• ì•ˆë‚´í‘œì‹œ
        st.markdown(
            f"""
            â€¢ ì„ íƒëœ ëª©ì ì§€ ìœ í˜•: **{destination_type}**  
            â€¢ ëª©í‘œ: ì²« ë²ˆì§¸ ë™ ì¶œì…êµ¬ ê¸°ì¤€ ì•ˆë‚´  
            â€¢ ì‹œê°„ ë‹¨ì¶•: í‰ê·  23%  
            â€¢ ê¸´ê¸‰ìƒí™© ëŒ€ì‘: ìµœì í™”
            """
        )

    st.divider()
    st.subheader("ğŸ“ˆ ì„±ëŠ¥ ë¹„êµ")

    comp_df = pd.DataFrame(
        {
            "êµ¬ë¶„": ["ë„ë‹¬ì‹œê°„", "ì •í™•ë„", "ì‚¬ìš©ì ë§Œì¡±ë„", "ê¸´ê¸‰ëŒ€ì‘"],
            "AS IS": [5.2, 75.3, 3.2, 6.8],
            "TO BE": [4.0, 97.8, 4.8, 4.4],
            "ê°œì„ ìœ¨": [23, 30, 50, 35],
        }
    )

    m_c1, m_c2, m_c3, m_c4 = st.columns(4)
    with m_c1:
        st.metric("í‰ê·  ë„ë‹¬ì‹œê°„", "4.0ë¶„", "-1.2ë¶„ (23%â†“)")
    with m_c2:
        st.metric("ëª©ì ì§€ ì •í™•ë„", "97.8%", "+22.5%p")
    with m_c3:
        st.metric("ì‚¬ìš©ì ë§Œì¡±ë„", "4.8/5.0", "+1.6ì ")
    with m_c4:
        st.metric("ê¸´ê¸‰ëŒ€ì‘ì‹œê°„", "4.4ë¶„", "-2.4ë¶„ (35%â†“)")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Tab 2: íš¨ê³¼ ë¶„ì„
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with effect_tab:
    st.subheader("ğŸ“Š MAT ì•Œê³ ë¦¬ì¦˜ íš¨ê³¼ ë¶„ì„")

    e1, e2 = st.columns(2)

    with e1:
        st.markdown("#### ì‹œê°„ëŒ€ë³„ ë„¤ë¹„ê²Œì´ì…˜ ì„±ëŠ¥")
        time_df = pd.DataFrame(
            {
                "ì‹œê°„ëŒ€": ["06-09", "09-12", "12-15", "15-18", "18-21", "21-24"],
                "AS IS": [5.8, 4.9, 4.7, 6.2, 5.5, 4.3],
                "TO BE": [4.2, 3.8, 3.6, 4.8, 4.1, 3.4],
            }
        )
        fig = px.line(time_df, x="ì‹œê°„ëŒ€", y=["AS IS", "TO BE"], title="í‰ê·  ë„ë‹¬ì‹œê°„ (ë¶„)", markers=True)
        fig.update_layout(height=320, legend_title_text="")
        st.plotly_chart(fig, use_container_width=True)

    with e2:
        st.markdown("#### ì•„íŒŒíŠ¸ ë‹¨ì§€ë³„ ê°œì„  íš¨ê³¼")
        apt_df = pd.DataFrame(
            {
                "ì•„íŒŒíŠ¸": ["í•œê°•ì„¼íŠ¸ëŸ´", "ì‹ ë¦¬ë§ˆì„", "ê³ ë•ë˜ë¯¸ì•ˆ", "ê³ ë•ê·¸ë¼ì‹œì›€"],
                "ì‹œê°„ë‹¨ì¶•ë¥ ": [25, 23, 28, 19],
                "ì •í™•ë„ê°œì„ ": [22, 28, 24, 26],
            }
        )
        fig2 = px.bar(apt_df, x="ì•„íŒŒíŠ¸", y=["ì‹œê°„ë‹¨ì¶•ë¥ ", "ì •í™•ë„ê°œì„ "], title="ë‹¨ì§€ë³„ ê°œì„  íš¨ê³¼ (%)", barmode="group")
        fig2.update_layout(height=320, legend_title_text="")
        st.plotly_chart(fig2, use_container_width=True)

    st.divider()
    st.markdown("#### ğŸš¨ ê¸´ê¸‰ìƒí™© ëŒ€ì‘ íš¨ê³¼")

    k1, k2, k3 = st.columns(3)
    with k1:
        st.markdown("**í™”ì¬ ìƒí™©**")
        st.metric("ì†Œë°©ì°¨ ë„ë‹¬ì‹œê°„", "3.2ë¶„", "-2.1ë¶„")
        st.metric("ì†Œí™”ì „ ì ‘ê·¼ì‹œê°„", "45ì´ˆ", "-1.3ë¶„")
    with k2:
        st.markdown("**ì‘ê¸‰ì˜ë£Œ ìƒí™©**")
        st.metric("êµ¬ê¸‰ì°¨ ë„ë‹¬ì‹œê°„", "3.8ë¶„", "-1.8ë¶„")
        st.metric("í™˜ì ì´ì†¡ì‹œê°„", "2.1ë¶„", "-0.9ë¶„")
    with k3:
        st.markdown("**ì¹˜ì•ˆ ìƒí™©**")
        st.metric("ê²½ì°°ì°¨ ë„ë‹¬ì‹œê°„", "4.1ë¶„", "-1.5ë¶„")
        st.metric("í˜„ì¥ ì ‘ê·¼ì‹œê°„", "1.2ë¶„", "-0.7ë¶„")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Tab 3: ì‹¤ì‹œê°„ ì‹œë®¬ë ˆì´ì…˜
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
with sim_tab:
    st.subheader("ğŸ—ºï¸ ì‹¤ì‹œê°„ ë„¤ë¹„ê²Œì´ì…˜ ì‹œë®¬ë ˆì´ì…˜")

    s1, s2, s3 = st.columns(3)
    with s1:
        simulation_mode = st.selectbox("ì‹œë®¬ë ˆì´ì…˜ ëª¨ë“œ", ["ì¼ë°˜ ì£¼í–‰", "ê¸´ê¸‰ ì¶œë™", "ì•¼ê°„ ìš´í–‰"], index=0)
    with s2:
        vehicle_type = st.selectbox("ì°¨ëŸ‰ ìœ í˜•", ["ì¼ë°˜ ìŠ¹ìš©ì°¨", "ì†Œë°©ì°¨", "êµ¬ê¸‰ì°¨", "ê²½ì°°ì°¨"], index=0)
    with s3:
        if st.button("â–¶ï¸ ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘", type="primary"):
            st.success("ì‹œë®¬ë ˆì´ì…˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!")

    st.markdown("#### ğŸ“ í•˜ë‚¨ì‹œ ì „ì²´ ì•„íŒŒíŠ¸ ë‹¨ì§€ í˜„í™©")

    # ì „ì²´ ì§€ë„
    m_total = folium.Map(location=[37.5539, 127.1650], zoom_start=14, tiles="OpenStreetMap")

    colors = ["blue", "green", "red", "purple"]
    for i, (apt_name, apt) in enumerate(HANAM_APARTMENTS.items()):
        color = colors[i % len(colors)]

        folium.Marker(
            location=apt["center"],
            popup=f"{apt_name}<br>ë“±ë¡ ë™ìˆ˜: {len(apt['buildings'])}ê°œ",
            icon=folium.Icon(color=color, icon="home"),
        ).add_to(m_total)

        if apt["buildings"]:
            route = [apt["entrance"]] + [[b["lat"], b["lon"]] for b in apt["buildings"]]
            folium.PolyLine(
                locations=route,
                color=color,
                weight=2,
                opacity=0.6,
                popup=f"{apt_name} MAT ê²½ë¡œ",
            ).add_to(m_total)

    # ê°„ë‹¨í•œ ë²”ë¡€
    legend_html = (
        """
        <div style="position: fixed; top: 10px; right: 10px; width: 200px; 
                    background-color: white; border: 1px solid #AAA; 
                    z-index: 9999; font-size: 14px; padding: 10px;">
          <p><b>ì•„íŒŒíŠ¸ ë‹¨ì§€</b></p>
          <p style=\"margin:0\"><span style=\"color:blue\">â—</span> í•œê°•ì„¼íŠ¸ëŸ´íŒŒí¬</p>
          <p style=\"margin:0\"><span style=\"color:green\">â—</span> ì‹ ë¦¬ë§ˆì„</p>
          <p style=\"margin:0\"><span style=\"color:red\">â—</span> ê³ ë•ë˜ë¯¸ì•ˆ</p>
          <p style=\"margin:0\"><span style=\"color:purple\">â—</span> ê³ ë•ê·¸ë¼ì‹œì›€</p>
        </div>
        """
    )
    m_total.get_root().html.add_child(folium.Element(legend_html))

    st_folium(m_total, use_container_width=True, height=480)

    st.divider()
    st.markdown("#### ğŸ“ˆ ì‹¤ì‹œê°„ ì„œë¹„ìŠ¤ í˜„í™©")

    a, b, c, d, e = st.columns(5)
    with a:
        st.metric("í™œì„± ì‚¬ìš©ì", "1,247ëª…", "+156")
    with b:
        st.metric("ì˜¤ëŠ˜ ê²½ë¡œ ì•ˆë‚´", "3,482ê±´", "+234")
    with c:
        st.metric("í‰ê·  ì‘ë‹µì‹œê°„", "0.23ì´ˆ", "-0.02ì´ˆ")
    with d:
        st.metric("ì‹œìŠ¤í…œ ê°€ë™ë¥ ", "99.8%", "+0.1%")
    with e:
        st.metric("ê¸´ê¸‰ ì¶œë™ ê±´ìˆ˜", "12ê±´", "+3")

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Footer
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
st.divider()
st.markdown(
    f"""
    #### ğŸ“‹ ì—°êµ¬ ì •ë³´
    - **ì—°êµ¬ì§€ì—­**: ê²½ê¸°ë„ í•˜ë‚¨ì‹œ (ë¯¸ì‚¬ê°•ë³€ë„ì‹œ, ê³ ë•ì‹ ë„ì‹œ)  
    - **ì ìš© ê¸°ìˆ **: ë²¡í„° ì¤‘ì¶• ë³€í™˜(MAT) ì•Œê³ ë¦¬ì¦˜  
    - **ë°ì´í„° ì¶œì²˜**: êµ­í† ì§€ë¦¬ì •ë³´ì›, í•˜ë‚¨ì‹œì²­, ì£¼ì†Œì •ë³´ê¸°ë³¸ë„  
    - **ì—…ë°ì´íŠ¸**: {datetime.now().strftime('%Y-%m-%d')} ê¸°ì¤€
    """
)
